---
title: "try_equation"
author: "CRISCI Emma"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Fonctions utilisées
```{r}
# S. Charles (2022-03-10)
rm(list = ls())
library(tidyverse)
```


```{r}
                ## GENERAL FONCTION ##
# DIFFUSION LAW
# Function Diffusion to the compartment 1 to compartment 2
DIFF <- function(C1, C2, k, kdiff){
  # C1: matrix(time)
  # C2: matrix(time)
  # k: constant max
  # kdiff: constant diffusion
  phi <- k + kdiff * (C1-C2)
  return (phi)
}

# MASS ACTION LAW
# Function MA(m,n) (equation 5) Mass Action
MA <- function(sub, k, produit, inhib, Keq, Ki){
  # time: vector of time points
  # sub : matrix of substrat concentration (time)
  # produit : vector of n products concentration
  # inhib: vector of inhibitor
  # k: constant max
  # Km: vector of MM constants 
  # Keq: equilibrium constant
  # Ki: Inhibitor constant
  phi <- k * (prod(sub) - (prod(produit) / Keq)) / ( 1 + inhib/Ki )
}
# /!\ value put by default for P, I, Keq, Ki, in case of the equation is not reversible and has no inhibitors

# MICHAELIS MENTEN LAW
MM <- function(sub, k, Km, produit, Keq, inhib, Ki){
  # time: vector of time points
  # sub : matrix of substrat concentration (time)
  # produit : vector of n products concentration
  # inhib: vector of inhibitor
  # k: constant max
  # Km: vector of MM constants
  # Keq: equilibrium constant
  # Ki: Inhibitor constant
  phi <- k * (prod(sub) - prod(produit)/Keq) / (1 + (prod(sub)+prod(produit))/Km + sum(inhib)/Ki)
  return(phi)
}
                ## PARTICULAR FONCTION ##
## GPx / GR

# MICHAELIS MENTEN LAW
MM_GPx_GR <- function(sub, k, Km, Un){
  # time: vector of time points
  # sub : matrix of substrat concentration (time)
  # k: constant max
  # Km: vector of MM constants
  # Un: if Un == 0 : GPx AND if Un == 1 : GR
  phi <- k * (prod(sub)) / (Un + sum(sub/Km)) # need to have the S in the same order than Km
  return(phi)
}

## Constant (need ?)
CONST <- function(k){
  return(k)
}
```

## Function study

### Diffusion
Variation of de [substrat]
```{r}
# Diffusion 
substrat <- seq(1,1000) # x
res <- sapply(substrat,DIFF,C2 = 5, k = 82.1486, kdiff=0.2016)#y

plot(x = substrat, y = res, main = "Exemple of the Diffusion function with Cext changing", xlab= "External Consentration", ylab= "Law rate dS/dt", las=1, type="l")
# Start condition
segments(x0 = 500, y0 = 0, x1 = 500, y1 = res[500], col = "red", lty = "dotted") 
segments(x0 = 0, y0 = res[500], x1 = 500, y1 = res[500], col = "red", lty = "dotted")
head(res)
rm(res, substrat)
```
Graph 1 : More the external concentration is more the coefficiant (Cext-Cin) is higher = quick the H202 go inside the cell. Like in this graph => always positif, we have always the H202 that go inside the cell.Red ligne show the initial condition chose by the article

Variation of le kdiff
```{r}
# Diffusion 
substrat <- seq(0.01, 0.4, by=0.01) # x
res <- sapply(substrat,DIFF,C1= 500, C2 = 5, k = 82.1486) # y

plot(x = substrat, y = res, main = "Exemple of the Diffusion function with k diff changing", xlab= "k diff", ylab= "Law rate dS/dt", las=1, type="l")
# Start condition
segments(x0 = 0.2016, y0 = 0, x1 = 0.2016, y1 = res[20], col = "red", lty = "dotted") 
segments(x0 = 0, y0 = res[20], x1 = 0.2016, y1 = res[20], col = "red", lty = "dotted")
head(res)
rm(res, substrat)
```
Graph 2 ; more k diff is higher, quick the H20 go inside the cell

### Mass action

Exemple with NNH who is MA(1,0)
```{r}
# MA
substrat <- seq(1,1000) # x
res <- sapply(substrat, MA, k = 4.2345 , produit = 0, inhib=0, Keq=1, Ki=1)#y

plot(x = substrat, y = res, main = "Exemple of the Diffusion function with concentration changing", xlab= "Consentration", ylab= "Law rate dS/dt", las=1, type="l")
head(res)
rm(res, substrat)
```

# Reactions
```{r}
# Example for phi_OX: T
# substrate: S = [H2O2]ext
k       <- 82.1486
kdiff   <- 0.2016
H202ext <- 500 # Only this metabolite consentration is a constant
S       <- 5 # arbitrary value chosen to try the MMs function
phi_OX <- DIFF(H202ext, S, k, kdiff)

# Example for phi_CAT: MA(1,0)
# substrate: S = [H2O2]
sub     <- 5 # arbitrary value chosen to try the MMs function 
produit <- 0 # No products
inhib   <- 0 # No inhibitors
k   <- 0.0879 # kCAT
Keq <- 1 # No
Ki  <- 1  # No inhibitors
phi_CAT <- MA(sub, k, produit, inhib, Keq, Ki)

# Example for phi_GPx: MM(2,0)
# substrates: S = [H2O2] and [GSH]  /  products: P = [GSSG] 
sub     <- c(2,5) # arbitrary value chosen to try the MMs function 
k <- 2.3736 # kGPx
Km <- 65    # KmGGR, KmNGR
sub <- 5 # arbitrary value chosen to try the MMs function
phi_PRPP <- MM_GPx_GR(sub, k, Km, Un=0)

print(phi_OX)
print(phi_CAT)
print(phi_PRPP)
```
# Modeling the system

## phi
```{r}
c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
length(c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0))
```

## Differencial equation

matrice de stochiométrie
```{r}
sys_sto_ode <- c(c(1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0), c(0,0,-2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0), c(0,0,0,-1,1,-1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0),c(0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,1,-1,0,0,0,0,0,0),c(0,0,0,0,0,0,1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),c(0,0,0,0,0,0,0,1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0), c(0,0,0,0,0,0,0,0,1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0), c(0,0,0,0,0,0,0,0,0,0,1,0,-1,0,-1,0,0,0,0,0,0,0,0), c(0,0,0,0,0,0,0,0,0,1,0,-1,-1,0,0,0,0,0,0,0,0,0,0), c(0,0,0,0,0,0,0,0,0,0,0,0,1,-1,0,0,0,0,0,0,0,0,0), c(0,0,0,0,0,0,0,0,0,0,0,0,0,1,-1,0,0,0,0,0,0,0,0), c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,1,0),c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,-1,0,0,0,0,1),c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,-1,0,0,0,0),c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,-1,0,0,0),c(0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,1,-1,0,-1),c(0,0,1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),c(0,0,0,1,-1,1,-1,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0))
name_equa_diff <- c("H2O2","GSH","NADPH","G6P","6PGL","6PG","Ru5P","X5P","R5P","S7P","E4P","GLC","F6P","FBP","DHAP","GAP","GSSG","NADPp")
name_phi       <- c("phi_OX","phi_CAT","phi_GPx","phi_GR","phi_NNH","phi_NHN","phi_G6PD","phi_6PGL","phi_6PGD","phi_RPI","phi_RPE","phi_PRPP","phi_TKT1","phi_TLD","phi_TKT2","phi_HK","phi_PGI","phi_PFK","phi_ALD","phi_TPI","phi_GAPD","phi_GLU","phi_TAL")
head(sys_sto_ode)
mat_stochio <- matrix(sys_sto_ode, nrow=23)
colnames(mat_stochio) <- name_equa_diff
rownames(mat_stochio) <- name_phi
mat_stochio_equadiff <- t(mat_stochio)
head(mat_stochio_equadiff)
```
metabolite vector
```{r}
syst <- function(t,y,parameter,matrix_syst){
  dy <- c(
    DIFF(500, x[1], 82.1486, 0.2016),
    MA(sub=x[1], k=0.0879, produit=0, inhib=0, Keq=1, Ki=1),
    MM_GPx_GR(sub=c(x[1],x[2]), k=2.3736, Km=c(0.0099,26.687), Un=0),
    MM_GPx_GR(sub=c(x[17],x[3]), k=400.959, Km=c(564.417,1.389), Un=1),
    MA(sub=x[18], k=4.2345, produit=0, inhib=0, Keq=1, Ki=1),
    MA(sub=x[18], k=0.0604, produit=0, inhib=x[1], Keq=1, Ki=351.156),
    MA(sub=c(x[4],x[18]), k=1.8574, produit=0, inhib=x[3], Keq=1, Ki=58762.0),
    MA(sub=x[5], k=10.0046, produit=0, inhib=0, Keq=1, Ki=1),   

    
    MM(sub=c(x[1],x[2]), k, Km, produit, Keq, inhib, Ki)
  )
  
}
```


Parameter Table
```{r}
  
```

matrice phi
```{r}

```

